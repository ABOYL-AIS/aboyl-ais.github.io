<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>问卷跳转中</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #f5f5f5;
      font-family: "Microsoft YaHei", sans-serif;
    }
    .msg {
      text-align: center;
      font-size: 18px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="msg" id="msg">正在准备问卷...</div>

  <script>
    // =============== 1. 检测是否刚完成一份问卷 ===============
    if (localStorage.getItem('has_redirected') === 'true') {
      // 用户从问卷返回，说明刚完成一份
      let done = parseInt(localStorage.getItem('survey_done_count') || '0');
      done += 1;
      localStorage.setItem('survey_done_count', done.toString());
      localStorage.removeItem('has_redirected'); // 清除标记
    }

    // =============== 2. 问卷链接池 ===============
    const urls = [
      "https://www.wjx.cn/vm/OIINUdi.aspx",
      "https://www.wjx.cn/vm/wFuyCIf.aspx",
      "https://www.wjx.cn/vm/eoE3bHt.aspx",
      "https://www.wjx.cn/vm/ty4UqKF.aspx",
      "https://www.wjx.cn/vm/hTmouAO.aspx",
      "https://www.wjx.cn/vm/Y8GWIpm.aspx",
      "https://www.wjx.cn/vm/tCs4UvJ.aspx",
      "https://www.wjx.cn/vm/rgLpid4.aspx",
      "https://www.wjx.cn/vm/PpHqbVx.aspx",
      "https://www.wjx.cn/vm/YDpmxyN.aspx",
      "https://www.wjx.cn/vm/PKWqvJk.aspx",
      "https://www.wjx.cn/vm/QJeHCnD.aspx",
      "https://www.wjx.cn/vm/ts41axa.aspx",
      "https://www.wjx.cn/vm/Ow7KIIi.aspx",
      "https://www.wjx.cn/vm/Ol8i7Kb.aspx",
      "https://www.wjx.cn/vm/QJhFCna.aspx",
      "https://www.wjx.cn/vm/QE0CnaM.aspx",
      "https://www.wjx.cn/vm/OwuVJi7.aspx",
      "https://www.wjx.cn/vm/eI6HtXI.aspx"
    ];

    // =============== 3. 状态读取 ===============
    let doneCount = parseInt(localStorage.getItem('survey_done_count') || '0');
    let selectedIndices = JSON.parse(localStorage.getItem('selected_indices') || '[]');

    const msgEl = document.getElementById('msg');

    // =============== 4. 已完成两份？跳感谢页 ===============
    if (doneCount >= 2) {
      setTimeout(() => {
        window.location.href = 'thanks.html';
      }, 500);
      return;
    }

    // =============== 5. 预选两个不重复的索引（仅在第一次进入时） ===============
    if (selectedIndices.length === 0) {
      // 随机打乱索引，取前两个
      const allIndices = [...Array(urls.length).keys()];
      for (let i = allIndices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allIndices[i], allIndices[j]] = [allIndices[j], allIndices[i]];
      }
      selectedIndices = allIndices.slice(0, 2); // 只取两个
      localStorage.setItem('selected_indices', JSON.stringify(selectedIndices));
    }

    // =============== 6. 跳转当前应完成的问卷 ===============
    const currentIndex = doneCount; // 0 或 1
    const targetIndex = selectedIndices[currentIndex];
    const targetUrl = urls[targetIndex];

    msgEl.innerHTML = `正在跳转第 ${doneCount + 1} 份问卷（共2份）...`;

    setTimeout(() => {
      localStorage.setItem('has_redirected', 'true'); // 标记即将跳转
      window.location.href = targetUrl;
    }, 800);
  </script>
</body>
</html>